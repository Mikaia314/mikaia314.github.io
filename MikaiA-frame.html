<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>A-Frame Fixed Scene</title>

  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>

  <script>
    AFRAME.registerComponent("hit-box1", {
      init: function () {
        let visible = false;
        this.el.addEventListener("click", () => {
          if (!visible) {
            document.querySelector("#iconimage").emit("iconcubePush");
            visible = true;
          }
        });
      }
    });

    AFRAME.registerComponent("hit-box2", {
      init: function () {
        let visible = false;
        this.el.addEventListener("click", () => {
          if (!visible) {
            document.querySelector("#aimiaimage").emit("aimiamodelPush");
            visible = true;
          }
        });
      }
    });

    AFRAME.registerComponent("hit-box3", {
      init: function () {
        let visible = false;
        this.el.addEventListener("click", () => {
          if (!visible) {
            document.querySelector("#koyokiimage").emit("koyokimodelPush");
            visible = true;
          }
        });
      }
    });
  </script>

  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>
<a-scene
  fog="density:0;color:#bdaa82;far:84"
  vr-mode-ui="enabled: true"
>

  <!-- 環境 -->
  <a-entity
    environment="
      preset: yavapai;
      skyType: gradient;
      skyColor: #239849;
      horizonColor: #cfe0af;
      fog: 0.8;
      ground: canyon;
      groundYScale: 9.76;
      flatShading: true;
    ">
  </a-entity>

  <!-- Assets（すべて統合） -->
  <a-assets>
    <!-- textures -->
    <img id="icontexture" src="https://cdn.glitch.global/4e992269-6dcc-48d0-bedd-55bc02f4d070/Mikaia-20200801211111.png?v=1697367845161">
    <img id="icon-image" src="https://cdn.glitch.global/4e992269-6dcc-48d0-bedd-55bc02f4d070/mikaia4wy5hagrwv.png?v=1697367799436">
    <img id="aimia-image" src="https://cdn.glitch.global/4e992269-6dcc-48d0-bedd-55bc02f4d070/AimiAdesign.png?v=1698176105858">
    <img id="koyoki-image" src="https://cdn.glitch.global/4e992269-6dcc-48d0-bedd-55bc02f4d070/koyoki_design.png?v=1698176082152">

    <!-- models -->
    <a-asset-item id="AimiAModel" src="https://cdn.glitch.global/4e992269-6dcc-48d0-bedd-55bc02f4d070/AimiA06syeipu.glb?v=1697351085191"></a-asset-item>
    <a-asset-item id="KoyokiModel" src="https://cdn.glitch.global/4e992269-6dcc-48d0-bedd-55bc02f4d070/Koyoki_AnimationFIX2.glb?v=1698169801738"></a-asset-item>
  </a-assets>

  <!-- Icon Cube -->
  <a-entity position="0 1.7 -20">
    <a-box
      class="raycastable"
      src="#icontexture"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
      hit-box1
    ></a-box>

    <a-image
      id="iconimage"
      position="0 2 0"
      src="#icon-image"
      width="4"
      height="2"
      opacity="0"
      animation="property: opacity; to: 1; dur: 3000; startEvents: iconcubePush"
    ></a-image>
  </a-entity>

  <!-- AimiA -->
  <a-entity position="4 1.7 -20">
    <a-entity
      id="aimiamodel"
      class="raycastable"
      gltf-model="#AimiAModel"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
      hit-box2
    ></a-entity>

    <a-image
      id="aimiaimage"
      position="0 2 0"
      src="#aimia-image"
      width="4"
      height="2"
      opacity="0"
      animation="property: opacity; to: 1; dur: 3000; startEvents: aimiamodelPush"
    ></a-image>
  </a-entity>

  <!-- Koyoki -->
  <a-entity position="-4 1 -20">
    <a-entity
      id="koyokimodel"
      class="raycastable"
      gltf-model="#KoyokiModel"
      scale="0.1 0.1 0.1"
      animation-mixer="clip: idle"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
      hit-box3
    ></a-entity>

    <a-image
      id="koyokiimage"
      position="0 2.7 0"
      src="#koyoki-image"
      width="4"
      height="2"
      opacity="0"
      animation="property: opacity; to: 1; dur: 3000; startEvents: koyokimodelPush"
    ></a-image>
  </a-entity>

  <!-- Mouse Cursor -->
  <a-entity
    cursor="rayOrigin: mouse"
    raycaster="objects: .raycastable">
  </a-entity>

</a-scene>
</body>
</html>
